{% extends "base.html" %}

{% block title %}Home - Stockton Esports{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='calendar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='modals.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='events.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero">
    <div class="hero-content">
        <div class="hero-top">
            <div class="hero-text">
               <h1>
                   Welcome to<br>
                   <span class="hero-gradient">Stockton Esports</span>
                </h1>
                <p>
                    Your centralized hub for competitive gaming, team management, and community engagement.
                    Join us in building the future of collegiate esports at Stockton University.
                </p>
            </div>
            <div class="hero-twitch" id="twitchContainer">
                <h3 class="live-indicator">Stockton Esports Twitch is LIVE!</h3>
                <div id="twitchEmbed"></div>
            </div>
        </div>
        <div class="hero-actions">
            {% if session.loggedin %}
                <a href="{{ url_for('dashboard') }}" class="btn btn-primary btn-large">Go to Dashboard</a>
            {% else %}
                <a href="{{ url_for('register') }}" class="btn btn-primary btn-large">Get Started</a>
                <a href="{{ url_for('login') }}" class="btn btn-secondary btn-large">Sign In</a>
            {% endif %}
        </div>
    </div>

    <div class="scroll-indicator">
        <span>Scroll to explore</span>
        <div class="scroll-arrow">â†“</div>
    </div>
</section>

<!-- Calendar Section -->
<section class="calendar-section">
    <div class="container">
        <div class="features-header">
            <h2>Upcoming Events</h2>
            <p>Stay up to date with matches, practices, and community events</p>
        </div>

        <div class="calendar-container">
            <!-- Calendar Navigation -->
            <div class="calendar-navigation">
                <a href="#" class="nav-button" id="prevMonth">
                    <i class="fas fa-chevron-left"></i>
                    <span>Previous</span>
                </a>
                <h2 class="calendar-month-year" id="currentMonthYear"></h2>
                <a href="#" class="nav-button" id="nextMonth">
                    <span>Next</span>
                    <i class="fas fa-chevron-right"></i>
                </a>
            </div>

            <!-- Calendar Main -->
            <div class="calendar-main">
                <div class="calendar-wrapper">
                    <!-- Calendar Header -->
                    <div class="calendar-header">
                        <div class="calendar-day-name">SUN</div>
                        <div class="calendar-day-name">MON</div>
                        <div class="calendar-day-name">TUE</div>
                        <div class="calendar-day-name">WED</div>
                        <div class="calendar-day-name">THU</div>
                        <div class="calendar-day-name">FRI</div>
                        <div class="calendar-day-name">SAT</div>
                    </div>

                    <!-- Calendar Grid -->
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="calendar-sidebar">
                <div class="sidebar-card">
                    <h3><i class="fas fa-palette"></i> Event Types</h3>
                    <div class="legend-items">
                        <div class="legend-item">
                            <div class="legend-color tournament"></div>
                            <span class="legend-label">Tournament</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color match"></div>
                            <span class="legend-label">Match</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color practice"></div>
                            <span class="legend-label">Practice</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color event"></div>
                            <span class="legend-label">Event</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color misc"></div>
                            <span class="legend-label">Miscellaneous</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-card">
                    <h3><i class="fas fa-calendar-day"></i> Today's Events</h3>
                    <div class="today-events-list" id="todayEventsList">
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">No events today</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Event Details Modal -->
<div id="eventDetailsModal" class="modal">
    <div class="modal-content modal-content-large">
        <div class="modal-header">
            <h2 id="eventModalTitle">Event Details</h2>
            <button class="modal-close" onclick="closeEventModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="eventModalBody">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading...</p>
            </div>
        </div>
    </div>
</div>

<!-- Day Events Modal -->
<div id="dayEventsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="dayModalTitle">Events</h2>
            <button class="modal-close" onclick="closeDayModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="dayModalBody"></div>
    </div>
</div>

<!-- Features Section -->
<section class="features">
    <div class="container">
        <div class="features-header">
            <h2>Everything You Need</h2>
            <p>A comprehensive platform designed specifically for the Stockton Esports community</p>
        </div>

        <div class="features-grid">
            <div class="feature-card">
                <span class="feature-icon">ðŸ“…</span>
                <h3>Visual Calendar</h3>
                <p>Stay on top of matches, practices, and community events with customizable alerts and an intuitive calendar interface.</p>
            </div>

            <div class="feature-card">
                <span class="feature-icon">ðŸ‘¥</span>
                <h3>Team Management</h3>
                <p>Game Managers can easily create and manage rosters, schedules, and send match reminders to keep teams coordinated.</p>
            </div>

            <div class="feature-card">
                <span class="feature-icon">ðŸŽ¥</span>
                <h3>VOD Review</h3>
                <p>Upload and annotate match recordings to provide structured feedback and help players improve their gameplay.</p>
            </div>

            <div class="feature-card">
                <span class="feature-icon">ðŸ“Š</span>
                <h3>Analytics Dashboard</h3>
                <p>Track team data, event statistics, and community engagement with comprehensive analytics and insights.</p>
            </div>

            <div class="feature-card">
                <span class="feature-icon">ðŸ’¬</span>
                <h3>Centralized Communication</h3>
                <p>Replace fragmented tools with a single platform that combines scheduling, communication, and management features.</p>
            </div>

            <div class="feature-card">
                <span class="feature-icon">ðŸŽ®</span>
                <h3>Community Events</h3>
                <p>Enhance engagement through better event visibility, attendance tracking, and customizable notifications.</p>
            </div>
        </div>
    </div>
</section>

<!-- Stats Section -->
<section class="stats">
    <div class="container">
        <div class="stats-grid">
            <div class="stat-item">
                <h3>500+</h3>
                <p>Active Players</p>
            </div>
            <div class="stat-item">
                <h3>20+</h3>
                <p>Competitive Teams</p>
            </div>
            <div class="stat-item">
                <h3>100+</h3>
                <p>Events Hosted</p>
            </div>
            <div class="stat-item">
                <h3>24/7</h3>
                <p>Platform Access</p>
            </div>
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="cta">
    <div class="container">
        {% if session.loggedin %}
            <h2>Welcome Back, {{ session.username }}!</h2>
            <p>Your dashboard is ready and waiting. Check your upcoming events, manage your teams, and stay connected with the Stockton Esports community.</p>
            <div class="hero-actions">
                <a href="{{ url_for('dashboard') }}" class="btn btn-primary btn-large">Go to Dashboard</a>
            </div>
        {% else %}
            <h2>Ready to Level Up?</h2>
            <p>Join the Stockton Esports community today and be part of something bigger. Whether you're a competitor or a casual player, there's a place for you here.</p>
            <div class="hero-actions">
                <a href="{{ url_for('register') }}" class="btn btn-primary btn-large">Create Account</a>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Set user login status for calendar functionality
    {% if session.loggedin %}
    window.currentUserId = {{ session.id }};
    {% endif %}
</script>
<!-- Load landing-calendar.js FIRST to define modal close handlers -->
<script src="{{ url_for('static', filename='landing-calendar.js') }}"></script>
<!-- Then load modals.js which references those handlers -->
<script src="{{ url_for('static', filename='modals.js') }}"></script>
<!-- DO NOT load events.js - it conflicts with landing calendar functions -->
<script src="https://embed.twitch.tv/embed/v1.js"></script>
<script>
    async function checkEmbedder() {
        const channelName = 'stocktonesports';
        const container = document.getElementById('twitchContainer');

        try {
            const proxyUrl = 'https://corsproxy.io/?';
            const targetUrl = encodeURIComponent(`https://www.twitch.tv/${channelName}`);

            const response = await fetch(proxyUrl + targetUrl);
            const html = await response.text();

            if (html.includes('"isLiveBroadcast":true') || html.includes('isLiveBroadcast":true')) {
                new Twitch.Embed("twitchEmbed", {
                width: 400,
                height: 225,
                channel: channelName,
                layout: "video",
                parent: ["127.0.0.1", "localhost"]  // Add domain here when deployed
            });
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
            }
        } catch (error) {
            console.error('Error fetching Twitch status:', error);
            container.style.display = 'none';
        }
    }

    checkEmbedder();
</script>
{% endblock %}